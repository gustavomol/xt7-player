' Gambas class file

Public artist As String
Public album As String
Public song As String
Public filename As String
Public Timestr As String
Public MouseOnOverlayTraytip As Boolean = False

Public Sub Redraw(tip As String, x As Integer, y As Integer)
  UpdateInfos()
  If y + Me.h > Desktop.h Then y = Desktop.h - Me.h
  If x + Me.w + 8 > Desktop.w Then x = Desktop.w - Me.w - 8
  Me.Move(x, y)
  Me.stacking = Me.Above
End


Public Sub UpdateScreenshot()
  
    If Not (FMain.mplayer.Media_AudioOnly() Or FMain.mplayer.paused) Then
      panel1.Arrangement = Arrange.None
      picturebox1.picture = FMain.mplayer.GetScreenShot(True)
      Try picturebox1.h = picturebox1.w / (FMain.mplayer.VideoOut_Width / FMain.mplayer.VideoOut_Height)
  Endif
  
End



Public Sub Form_Show()

  picturebox1.w = panel1.w
  UpdateScreenshot()
  Global.CenterObj(panel1, picturebox1)
  picturebox1.x = 0
  UpdateInfos()
  timer1.start
End


Public Sub Form_hide()
  timer1.stop
End

Public Sub Timer1_Timer()
  UpdateInfos()
End


Public Sub UpdateInfos()
    If Not (FMain.mplayer.Paused) Then
      If Not (btnplaypause.picture = Picture["icon:/16/pause"]) Then btnplaypause.picture = Picture["icon:/16/pause"]
        Else
      If Not (btnplaypause.picture = Picture["icon:/16/play"]) Then btnplaypause.picture = Picture["icon:/16/play"]
    Endif
    
    If FMain.mplayer.Media_AudioOnly() Then
      artist = FMain.PropertiesGrid[6, 1].text
      album = FMain.PropertiesGrid[5, 1].text
      song = FMain.PropertiesGrid[7, 1].text
      filename = File.BaseName(FMain.PropertiesGrid[1, 1].text) & "." & File.Ext(FMain.PropertiesGrid[1, 1].text)
      If Not FMain.mplayer.paused Then TimeStr = FMain.mplayer.FormatTime(FMain.mplayer.CurrentTime()) & " / " & FMain.mplayer.FormatTime(FMain.mplayer.Media_Length)
      If Trim(artist) = "" Then artist = "Unknown Artist"
      If Trim(album) = "" Then album = "Unknown Album"
      If Trim(song) = "" Then song = "Unknown song"
      If Trim(filename) = "" Then filename = "No file is playing"

      picturebox1.picture = AudioForm.CoverBox.Picture
      ' panel1.h = 90
      ' panel1.w = 90
      'picturebox1.h = 88
      panel1.Arrangement = Arrange.fill
      'picturebox1.h = panel1.h - 2
      'picturebox1.w = panel1.w - 2

      Global.CenterObj(panel1, picturebox1)
      'picturebox1.w = 88
      ' panel1.Refresh
      ' picturebox1.refresh

      
      label1.text = artist & "\n" & album & "\n" & song & "\n" & filename & "\n" & timestr
        Else
      Try filename = File.BaseName(FMain.PropertiesGrid[1, 1].text) & "." & File.Ext(FMain.PropertiesGrid[1, 1].text)
      If Not FMain.mplayer.paused Then TimeStr = FMain.mplayer.FormatTime(FMain.mplayer.CurrentTime()) & " / " & FMain.mplayer.FormatTime(FMain.mplayer.Media_Length)
      If Trim(filename) = "" Then filename = "No file is playing"
      label1.text = filename & "\n" & timestr
       ' IF NOT FMain.mplayer.paused THEN 
       '     TRY picturebox1.h = picturebox1.w / (FMain.mplayer.VideoOut_Width / FMain.mplayer.VideoOut_Height)
       '     TRY picturebox1.picture = FMain.mplayer.GetScreenShot(TRUE)
       ' ENDIF
      'none
    Endif
End

Public Sub Form_Leave()
  If pinbutton.value = False Then
    MouseOnOverlayTraytip = False
    OverlayTrayTip.hide
  Endif
  pinbutton.hide
  Me.Stacking = Me.normal
End

Public Sub Form_Enter()
  MouseOnOverlayTraytip = True
  pinbutton.show
  Me.Stacking = Me.Above
End

Public Sub btnprev_MouseDown()
  FMain.ButtonPrev_click()
End

Public Sub btnplaypause_MouseDown()
  FMain.ButtonPlay_click()
End

Public Sub btnstop_MouseDown()
  FMain.ButtonStop_click()
End

Public Sub btnnext_MouseDown()
  FMain.ButtonNext_click()
End

Public Sub Form_MouseWheel()
    If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub PictureBox1_MouseWheel()
    If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub Label1_MouseWheel()
      If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub HBox1_MouseWheel()
      If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End


Public Sub Label1_MouseDrag()
  Me.Move(Me.screenx + (mouse.x - mouse.StartX), Me.screeny + (mouse.y - mouse.Starty))
End


Public Sub pinbutton_MouseWheel()

  If (mouse.delta > 0) Then 
    Me.Opacity = Me.Opacity + 10
    Debug
      Else
    Me.Opacity = Me.Opacity - 10
  Endif
If Me.opacity = 0 Then Me.opacity = 10
End

Public Sub PictureBox1_MouseDown()
  FMain.show
End
