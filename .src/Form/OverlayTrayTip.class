' Gambas class file

Public artist As String
Public album As String
Public song As String
Public filename As String
Public Timestr As String
Public MouseOnOverlayTraytip As Boolean = False

' Public Sub Redraw(tip As String, x As Integer, y As Integer)
'   UpdateInfos()
'   If y + Me.h > desktop.h Then y = desktop.h - Me.h
'   x = x - (Me.w Div 2) + FMain.trayicon1.w
'   If x < 0 Then x = 0
'   Me.Move(x, y)
'   Me.stacking = Me.Above
' End

Public Sub Redraw(tip As String, x As Integer, y As Integer)
  Dim DesktopH As Integer = Global.DektopHTotal()
  Dim DesktopW As Integer = Global.DektopWTotal()
  UpdateInfos()
  If y + Me.h > Desktoph Then y = Desktoph - Me.h
  If x + Me.w + 8 > Desktopw Then x = Desktopw - Me.w - 8
  Me.Move(x, y)
  Me.stacking = Me.Above
End

Public Sub UpdateScreenshot()
  
    If Not (FMain.mplayer.Media_AudioOnly() Or FMain.mplayer.paused) Then
      panel1.Arrangement = Arrange.None
      picturebox1.picture = FMain.mplayer.GetScreenShot(True)
      Try picturebox1.h = picturebox1.w / (FMain.mplayer.VideoOut_Width / FMain.mplayer.VideoOut_Height)
  Endif
  
End


Public Sub Form_Show()

  picturebox1.w = panel1.w
  UpdateScreenshot()
  Global.CenterObj(panel1, picturebox1)
  picturebox1.x = 0
  UpdateInfos()
  timer1.start
End


Public Sub Form_hide()
  timer1.stop
End

Public Sub Timer1_Timer()
  UpdateInfos()
End


Public Sub UpdateInfos()
    If Not (FMain.mplayer.Paused) Then
      If Not (btnplaypause.picture = Picture["icon:/16/pause"]) Then btnplaypause.picture = Picture["icon:/16/pause"]
        Else
      If Not (btnplaypause.picture = Picture["icon:/16/play"]) Then btnplaypause.picture = Picture["icon:/16/play"]
    Endif
    
    If FMain.mplayer.Media_AudioOnly() Then
      artist = FMain.PropertiesGrid[6, 1].text
      album = FMain.PropertiesGrid[5, 1].text
      song = FMain.PropertiesGrid[7, 1].text
      filename = File.BaseName(FMain.PropertiesGrid[1, 1].text) & "." & File.Ext(FMain.PropertiesGrid[1, 1].text)
      If Not FMain.mplayer.paused Then TimeStr = FMain.mplayer.FormatTime(FMain.mplayer.CurrentTime()) & " / " & FMain.mplayer.FormatTime(FMain.mplayer.Media_Length)
      If Trim(artist) = "" Then artist = "Unknown Artist"
      If Trim(album) = "" Then album = "Unknown Album"
      If Trim(song) = "" Then song = "Unknown song"
      If Trim(filename) = "" Then filename = "No file is playing"

      picturebox1.picture = AudioForm.CoverBox.Picture
      panel1.Arrangement = Arrange.fill
      Global.CenterObj(panel1, picturebox1)

      label1.text = artist & "\n" & album & "\n" & song & "\n" & filename & "\n" & timestr
        Else
      Try filename = File.BaseName(FMain.PropertiesGrid[1, 1].text) & "." & File.Ext(FMain.PropertiesGrid[1, 1].text)
      If Not FMain.mplayer.paused Then TimeStr = FMain.mplayer.FormatTime(FMain.mplayer.CurrentTime()) & " / " & FMain.mplayer.FormatTime(FMain.mplayer.Media_Length)
      If Trim(filename) = "" Then filename = "No file is playing"
      label1.text = filename & "\n" & timestr

    Endif
End

Public Sub Form_Leave()
  If pinbutton.value = False Then
    MouseOnOverlayTraytip = False
    OverlayTrayTip.hide
  Endif
  pinbutton.hide
  Me.Stacking = Me.normal
End

Public Sub Form_Enter()
  MouseOnOverlayTraytip = True
  pinbutton.show
  Me.Stacking = Me.Above
End

Public Sub btnprev_MouseDown()
  FMain.ButtonPrev_click()
End

Public Sub btnplaypause_MouseDown()
  FMain.ButtonPlay_click()
End

Public Sub btnstop_MouseDown()
  FMain.ButtonStop_click()
End

Public Sub btnnext_MouseDown()
  FMain.ButtonNext_click()
End

Public Sub Form_MouseWheel()
    If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub PictureBox1_MouseWheel()
    If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub Label1_MouseWheel()
      If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End

Public Sub HBox1_MouseWheel()
      If mouse.delta > 0 Then
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value + 1
        Else
      FMain.SaveVolumeSlider.value = FMain.SaveVolumeSlider.value - 1
    Endif
End


' Public Sub Label1_MouseDrag()
'   Me.Move(Me.screenx + (mouse.x - mouse.StartX), Me.screeny + (mouse.y - mouse.Starty))
' End

Public Sub Label1_MouseMove()
  If mouse.left Then
    Me.Move(Me.screenx + (mouse.x - mouse.StartX), Me.screeny + (mouse.y - mouse.Starty))
  Endif
End

Public Sub pinbutton_MouseWheel()

  If (mouse.delta > 0) Then 
    Me.Opacity = Me.Opacity + 10
    Debug
      Else
    Me.Opacity = Me.Opacity - 10
  Endif
If Me.opacity = 0 Then Me.opacity = 10
End

Public Sub PictureBox1_MouseDown()
  FMain.show
End
