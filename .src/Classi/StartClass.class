' Gambas class file

Static Public signals As Integer[] = [6, 2, 1, 3, 15, 20]

Static Public Sub ProcessSignals(Doit As Boolean)
  Dim sig As Integer
  If doit
    For Each sig In signals
      Signal[sig].Catch
    Next
      Else
    For Each sig In signals
      Signal[sig].reset
    Next
  Endif
End


Static Public Sub main()
  'quicktest()
  ProcessSignals(True)
  zzzFake.Start()
End

Static Public Sub Application_Signal(Sig As Integer)
  Debug "Got Signal " & sig & " Quitting as clean as possible"
  Stop
  ProcessSignals(False)
  FMain.Close()
  Quit
End

Static Public Function MidC(s As String, a As String, Optional b As String) As String
  'return the first occurrence of the string between a and b
  'if b is omitted then all the string starting from a is returned
  Dim mmid As String
  mMid = Mid(s, InStr(s, a) + 1)
  If b <> "" Then 
    Return Left(mmid, InStr(mmid, b) - 1)
      Else
    Return mMid
  Endif
End


Static Public Sub quicktest()
  Dim feed As String[] = Split(file.Load("/tmp/yt.txt"), "<", "", True)
  Dim aline As String
  
  
  For Each aLine In feed
    Select Case aline
      Case Like "id>http" & "*"
        Debug "----------------------------------------"

      Case Like "id>http" & "*"
        Debug aline

      Case Like "published>" & "*"
        Debug "Published=" & MidC(aLine, ">", "T")

      Case Like "updated>" & "*"
        Debug "Updated=" & MidC(aLine, ">", "T")

      Case Like "title type='text'>" & "*"
        Debug "Title=" & MidC(aLine, ">")

      Case Like "media:title type='plain'>" & "*"
         Debug "Title=" & MidC(aLine, ">")

      Case Like "name>" & "*"
        Debug "Author=" & MidC(aLine, ">")

      Case Like "media:category label='" & "*"
        Debug "Category=" & Split(aline, "'")[1]

      Case Like "media:description type='plain'>" & "*"
        Debug "Description=" & MidC(aLine, ">")

      Case Like "media:thumbnail url='" & "*"
        Debug "Thumb=" & MidC(aLine, "'", "'")

      Case Like "yt:duration seconds='" & "*"
        Debug "Duration=" & MidC(aline, "'", "'")

      Case Like "media:player url='" & "*"
        Debug "Url=" & MidC(aline, "'", "'")

    End Select
  Next
  
  Quit
  
End
